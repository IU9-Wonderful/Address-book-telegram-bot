# Address-book-telegram-bot
Иван Лизунов

2025
### Телеграм бот - Адресная книга
Этот бот позволяет делиться местоположением важных для пользователей мест с другими.
### Принцип работы
#### /start
При запуске (команда /start) пользователь регистрируется в базе данных 
("address_book_telegram_bot\db\address_book.sqlite", таблица "users").
#### /info
Команда /info выводит пользователю список его мест (та же база данных, таблица "place"), с номерами.
Теперь он может ввести номер и редактировать место.

После указания номера места пользователю выводится его меню:
* Фото карты (yandex maps), загружается в момент запроса поиском адреса места в yandex maps api.
* Адрес (хранится в базе данных).
* Кто из других пользователей может видеть это место (список имён пользователей - @username).
* Ссылка на яндекс карты, по координатам из yandex maps geocoder. 

...и список команд:
* /change_address - заменяет адрес места, его главное свойство.
* /add_visible_for - добавляет пользователей в список тех, кто может видеть это место.
* /remove_visible_for - удаляет пользователей из списка тех, кто может видеть это место.
* /remove_address - удаляет адрес из базы данных.
* /back - см. ниже, в пункте про команду /back
#### /add_address
Команда для добавления новых мест в базу данных.
1. Пользователь вводит адрес места.
2. Ему присылается фото карты (yandex maps) и запрос на подтверждение.
3. Пользователь вводит "Нет" (копия команды /back) или "Да" (продолжение).
4. Дальше пользователь вводит имена пользователей (Имя пользователя - username), которые смогут увидеть это место
(/back для остановки.). После каждого имени оно регистрируется к этому месту в базе данных (таблица "place").
#### /get_friends_addresses
Команда для просмотра мест других пользователей (Если другие пользователи разрешили конкретному пользователю 
просматривать конкретное место).
1. Вводится имя пользователя (@username), места которого требуется просмотреть.
2. Выводится меню, как /info, нумерованный список мест.
3. Пользователь может ввести номер места, которое он хочет просмотреть подробнее.
4. Выводится:
   * Фото карты (yandex maps), загружается в момент запроса поиском адреса места в yandex maps api.
   * Адрес (хранится в базе данных).
   * Ссылка на яндекс карты, по координатам из yandex maps geocoder. 
#### /back
Команда сбрасывает статус пользователя (например, если он что-то вводит, действие отменяется).
#### /help
Общая информация о боте и список основных команд.
#### /remove_user
Команда очищает всю информацию о пользователе (очищает всё им созданное из базы данных):
* Удаляет пользователя из таблицы "users" базы данных.
* Удаляет все места из таблицы "places" базы данных, чей автор - пользователь, запросивший удаление.
* Удаляет все файлы, нужные для общения с этим пользователем.
### Файловое устройство
#### Address book telegram bot.py
Python файл - сам бот.
#### config.txt
Файл настроек бота:
* bot_token: токен бота в telegram, получать в telegram у @BotFather.
* yandex_maps_apikey: апи ключ яндекс карт, получать там: https://yandex.ru/maps-api/
* geocoder_apikey: апи ключ геокодера, получать там же: https://yandex.ru/maps-api/
#### db
Папка с базой данных address_book.sqlite, создаётся при первом запуске "Address book telegram bot.py". 
#### images
Папка для хранения фотографий и другой информации для взаимодействия с пользователями.
#### data
Папка с дополнительными частями программы:
* __all_models.py - модели для базы данных.
* config.py - взаимодействие с файлом настроек "address_book_telegram_bot/config.txt".
* db_session.py - взаимодействие с базой данных "address_book_telegram_bot/db/address_book.sqlite".
* yandex_maps.py - функции для взаимодействия с "yandex maps api" и api геокодера от яндекса.
